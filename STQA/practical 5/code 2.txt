package pract_5;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import jxl.Sheet;
import jxl.Workbook;
import jxl.read.biff.BiffException;
import jxl.write.WritableSheet;
import jxl.write.WritableWorkbook;
import jxl.write.Label;
import jxl.write.WriteException;

public class Pract_5 {

    public static void main(String[] args) throws FileNotFoundException, 
            IOException, BiffException, WriteException {
        FileInputStream is = new FileInputStream("D:\\TYCS\\STQA\\examdata.xls");
        Workbook w = Workbook.getWorkbook(is);
        Sheet s = w.getSheet(0);
        String a[][] = new String[s.getRows()][s.getColumns()];

        FileOutputStream os = new FileOutputStream("D:\\TYCS\\STQA\\result1.xls");
        WritableWorkbook wwb = Workbook.createWorkbook(os);
        WritableSheet ws = wwb.createSheet("RESULT", 0);

        // Step 1: Copy all original data
        for (int i = 0; i < s.getRows(); i++) {
            for (int j = 0; j < s.getColumns(); j++) {
                a[i][j] = s.getCell(j, i).getContents();
                Label l2 = new Label(j, i, a[i][j]);
                ws.addCell(l2);
            }
        }

        // Step 2: Add column headers
        Label resultHeader = new Label(6, 0, "Result");
        Label percentHeader = new Label(7, 0, "Percentage");
        ws.addCell(resultHeader);
        ws.addCell(percentHeader);

        // Step 3: Check each student's result and percentage
        for (int i = 1; i < s.getRows(); i++) {
            boolean pass = true;
            int total = 0;

            for (int j = 2; j < s.getColumns(); j++) {
                a[i][j] = s.getCell(j, i).getContents();
                int mark = Integer.parseInt(a[i][j]);
                if (mark <= 40) {
                    pass = false;
                }
                total += mark;
            }

            if (pass) {
                Label passLabel = new Label(6, i, "PASS");
                ws.addCell(passLabel);

                int numSubjects = s.getColumns() - 2;
                double percentage = (total * 100.0) / (numSubjects * 100); // assuming out of 100
                Label percentLabel = new Label(7, i, String.format("%.2f%%", percentage));
                ws.addCell(percentLabel);
            } else {
                Label failLabel = new Label(6, i, "FAIL");
                ws.addCell(failLabel);
                // Don't write percentage
            }
        }

        // Final step: write and close
        wwb.write();
        wwb.close();
        System.out.println("PASS/FAIL with Percentage for PASS students saved!");
    }
}
